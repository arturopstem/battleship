(()=>{"use strict";class e extends HTMLElement{constructor(e,t,o){super(),this.style.setProperty("--peg-color",e),this.style.setProperty("--peg-row",t+1),this.style.setProperty("--peg-column",o+1)}connectedCallback(){this.classList.add("fade-in")}}const t=e,o=["start","end"];class r extends HTMLFormElement{constructor(){super(),this.setAttribute("is","form-coords"),this.classList.add("form-coords"),this.autocomplete="off",this.autocapitalize="characters"}connectedCallback(){const e=o.map((e=>{const t=document.createElement("label");t.innerText=`${e.at().toUpperCase()}${e.slice(1)}:`;const o=document.createElement("input");o.name=e,o.type="text",o.pattern="^[a-jA-J](10|[1-9])$",o.required=!0,o.minLength=2,o.maxLength=3,o.size=3,o.addEventListener("input",(e=>{e.target.value=e.target.value.toUpperCase()}));const r=document.createElement("div");return r.appendChild(t),r.appendChild(o),r})),t=document.createElement("button");t.type="submit",t.innerText="Place Ship",this.append(...e,t)}}const s=r;function n(e){const t=document.createElement("div");if(t.classList.add("table-labels"),t.classList.add(`${e}-labels`),"row"===e)for(let e=0;e<10;e+=1){const o=document.createElement("div");o.innerText=e+1,t.appendChild(o)}else if("column"===e){const e="A".charCodeAt();for(let o=0;o<10;o+=1){const r=document.createElement("div");r.innerText=String.fromCharCode(e+o),t.appendChild(r)}}return t}const c=function(){return[n("row"),n("column"),function(){const e=document.createElement("div");e.classList.add("table");for(let t=0;t<10;t+=1)for(let o=0;o<10;o+=1){const r=document.createElement("div");r.classList.add("square"),r.dataset.row=t,r.dataset.col=o,e.appendChild(r)}return e}()]};class l extends HTMLElement{constructor(e,t){super();const[o,r]=e,[s,n]=t;this.style.setProperty("--row-start",o+1),this.style.setProperty("--row-end",s+2),this.style.setProperty("--column-start",r+1),this.style.setProperty("--column-end",n+2)}connectedCallback(){this.classList.add("fade-in")}}const a=l;class i extends HTMLElement{constructor(){super(),this.classList.add("board");const e=c();this.replaceChildren(...e)}displayPeg(e,o,r){const s=new t(e,o,r);this.querySelector(".table").appendChild(s)}displayShip(e,t){const o=new a(e,t);this.querySelector(".table").appendChild(o)}}const d=i;class u extends HTMLElement{constructor(){super(),this.classList.add("board"),this.classList.add("hidden");const e=c();this.replaceChildren(...e)}displayPeg(e,o,r){const s=new t(e,o,r);this.querySelector(".table").appendChild(s)}}const h=u;function p(e){const t=e.trim().match(/^(?<colStr>[a-jA-J])(?<rowStr>10|[1-9])$/);if(!t)return null;const{rowStr:o,colStr:r}=t.groups;return[Number(o)-1,r.toUpperCase().charCodeAt()-"A".charCodeAt()]}function m(e,t){return e.every(((e,o)=>e===t[o]))}function f(e,t){return e.some((e=>t.some((t=>m(t,e)))))}function w(e){if(e<2||e>5)return null;const t=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10;return Math.floor(Math.random()*e)},o=e-1,r={row:t(),col:t()},s={row:r.row+o,col:r.col+o};for(;s.row>9&&s.col>9;)[r.row,r.col]=[t(),t()],[s.row,s.col]=[r.row+o,r.col+o];if(s.row<10&&s.col<10){const e=Object.keys(s)[t(2)];s[e]=r[e]}else s.row<10?s.col=r.col:s.col<10&&(s.row=r.row);const n=[];for(let e=r.row;e<=s.row;e+=1)for(let t=r.col;t<=s.col;t+=1)n.push([e,t]);return n}function y(e){return e.reduce(((e,t)=>[...e,...t.coordinates]),[])}function b(){return[Math.floor(10*Math.random()),Math.floor(10*Math.random())]}function g(e,t){return t.some((t=>m(e,t)))}function S(e,t){return Boolean(t[e])}function v(e){return Object.keys(e).some((t=>0!==e[t]))}const C=class{constructor(e){this.length=e,this.hits=0,this.sunk=!1}hit(){this.hits+=1}isSunk(){return this.hits>=this.length}},E=class{constructor(){this.ships=[],this.missedAttacks=[]}placeShip(){for(var e=arguments.length,t=new Array(e),o=0;o<e;o++)t[o]=arguments[o];const{length:r}=t,s=new C(r);this.ships.push({ship:s,coordinates:t})}receiveAttack(e,t){const o=[e,t],r=this.ships.find((o=>{let{coordinates:r}=o;return r.some((o=>{let[r,s]=o;return r===e&&s===t}))}));return r?(r.ship.hit(),!0):(this.missedAttacks.push(o),!1)}hasAllShipsSunk(){return this.ships.every((e=>{let{ship:t}=e;return t.isSunk()}))}},L=class{constructor(e){this.type=e,this.gameboard=new E}};customElements.define("battle-peg",t),customElements.define("form-coords",s,{extends:"form"}),customElements.define("placement-board",d),customElements.define("ship-piece",a),customElements.define("tracking-board",h),function(){const e=document.querySelector(".boards");e.replaceChildren();const t=new h;e.appendChild(t);const o=new d;e.appendChild(o);const r=new s;e.appendChild(r),document.querySelector(".result-modal form").addEventListener("submit",(e=>{e.preventDefault(),window.location.reload()}))}();const k={5:1,4:1,3:2,2:1},A=new L("computer");Object.keys(k).forEach((e=>{for(;S(e,k);){const t=y(A.gameboard.ships);let o=w(e);for(;f(o,t);)o=w(e);A.gameboard.placeShip(...o),k[e]-=1}}));const q=new L("real");!function(e,t){const o=document.querySelector(".form-coords");o.elements.start.focus();const r=document.querySelector("placement-board"),s=document.querySelector("tracking-board");o.addEventListener("submit",(n=>{n.preventDefault();const c=t;if(v(c)){const t=o.elements,n=function(e,t){const o={row:e[0],col:e[1]},r={row:t[0],col:t[1]},s=r.row-o.row,n=r.col-o.col,c=[];if(0===s&&0===n)return c.push([o.row,o.col]),c;if(s*n!=0)return c;s<0&&([o.row,r.row]=[r.row,o.row]),n<0&&([o.col,r.col]=[r.col,o.col]);for(let e=o.row;e<=r.row;e+=1)for(let t=o.col;t<=r.col;t+=1)c.push([e,t]);return c}(p(t.start.value),p(t.end.value)),l=n.length,a=y(e.gameboard.ships);S(l,c)&&!f(n,a)&&(e.gameboard.placeShip(...n),r.displayShip(n.at(0),n.at(-1)),c[l]-=1,o.reset(),o.elements.start.focus()),v(c)||(o.remove(),s.classList.remove("hidden"))}}))}(q,{5:1,4:1,3:2,2:1}),function(e,t){const o=document.querySelector("tracking-board"),r=document.querySelector("placement-board"),s=document.querySelector(".result-modal"),n=s.querySelector(".result-message"),c=[];o.addEventListener("click",(l=>{if(l.target.classList.contains("square")){const a=l.target,i=Number(a.dataset.row),d=Number(a.dataset.col),u=t.gameboard,h=u.receiveAttack(i,d);if(o.displayPeg(h?"red":"white",i,d),u.hasAllShipsSunk())return n.innerText="Gratz You Win!",s.style.setProperty("--result-color","green"),void s.showModal();let p=b();for(;g(p,c);)p=b();c.push(p);const m=e.gameboard,f=m.receiveAttack(...p);r.displayPeg(f?"red":"white",...p),m.hasAllShipsSunk()&&(n.innerText="You Lose!",s.style.setProperty("--result-color","red"),s.showModal())}}))}(q,A)})();